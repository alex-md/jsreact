<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">

        <meta name="robots" content="index, follow">
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        <title>Terser Playground</title>
        <link rel="icon" href="./images/favicon.ico" type="image/x-icon" />
        <link rel="icon" type="image/png" href="./images/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="./images/favicon-16x16.png" sizes="16x16" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
        <link rel="stylesheet" href="./style/navbar.css">
        <link rel="stylesheet" href="./style/minify.css">
    </head>

    <body>
        <!-- Use the navbar class for the navigation bar -->
        <div class="navbar">
            <!-- Use the logo class for the logo image -->
            <img src="./images/logo.png" alt="logo" class="logo">
            <!-- Use the hamburger class for the hamburger menu -->
            <div class="hamburger" id="hamburger">
                <div></div>
                <div></div>
                <div></div>
            </div>
            <!-- Use the nav-links class for the list of links -->
            <ul class="nav-links" id="nav-links">
                <!-- Use the nav-link class for each link -->
                <li><a href="./index.html" class="nav-link">Code Editor</a></li>
                <li><a href="./chat.html" class="nav-link">Talk to GPT</a></li>
                <li><a href="./minify.html" class="nav-link">Minify Code</a></li>
            </ul>
        </div>
        <script>
            const hamburger = document.getElementById('hamburger');
            const navLinks = document.getElementById('nav-links');

            hamburger.addEventListener('click', function () {
                navLinks.classList.toggle('show');
            });
        </script>
        <h1>Terser Minifier</h1>
        <p>A JavaScript minifier powered by Terser. Terser is a JavaScript parser and minifier that provides a
            complete
            beautifier toolkit for ES6+.</p>
        <p>Enter your JavaScript code in the input textarea below, choose some options, and click the “Minify”
            button to see the output.</p>
        <div>
            <textarea id="input" rows="10" cols="80"></textarea>
        </div>

        <!-- Displaying options -->
        <div id="options">
            <label for="compress">Compress:</label>
            <input type="checkbox" id="compress" checked>
            <br>
            <label for="mangle">Mangle:</label>
            <input type="checkbox" id="mangle" checked>
            <br>
            <label for="beautify">Beautify:</label>
            <input type="checkbox" id="beautify" checked>
            <br>
            <label for="quotes">Quote Style:</label>
            <select id="quotes">
                <option value="0">Auto</option>
                <option value="1">Single</option>
                <option value="2">Double</option>
            </select>
        </div>

        <button id="minify">Minify</button>
        <span id="inputSizeLabel">Input Size: <div id="inputLabel">0</div> KB</span>
        <span id="outputSizeLabel">Output Size: <div id="outputLabel">0</div> KB</span>
        <div>
            <textarea id="output" wrap="hard" rows="10" cols="80" onchange="updateSizeLabels()"></textarea>
        </div>

        <script type="module">
            import { minify } from "https://cdn.skypack.dev/terser@5.17.7";
            // Get the elements by their ids
            var minifyButton = document.getElementById("minify");
            var inputSizeLabel = document.getElementById("inputSizeLabel");
            var outputSizeLabel = document.getElementById("outputSizeLabel");
            var inputLabel = document.getElementById("inputLabel");
            var outputLabel = document.getElementById("outputLabel");
            var inputArea = document.getElementById("input");
            var outputArea = document.getElementById("output");

            // Get the options by their ids
            var compressOption = document.getElementById("compress");
            var mangleOption = document.getElementById("mangle");
            var beautifyOption = document.getElementById("beautify");
            var quotesOption = document.getElementById("quotes");

            // Define a function to update the size labels
            function updateSizeLabels() {
                // Get the text content of the input and output areas
                var inputText = inputArea.value;
                var outputText = outputArea.value;

                // Calculate the size in bytes
                var inputSize = new Blob([inputText]).size;
                var outputSize = new Blob([outputText]).size;

                // Convert the size to kilobytes and round to two decimal places
                var inputKB = (inputSize / 1024).toFixed(2);
                var outputKB = (outputSize / 1024).toFixed(2);

                // Set the text content of the labels if the elements exist
                if (inputLabel) {
                    inputLabel.textContent = inputKB;
                }
                if (outputLabel) {
                    outputLabel.textContent = outputKB;
                }
            }

            // Define a function to minify the input code using Terser
            function minifyCode() {
                // Get the text content of the input area
                var inputText = inputArea.value;

                // Get the values of the options
                var compress = compressOption.checked;
                var mangle = mangleOption.checked;
                var beautify = beautifyOption.checked;
                var quotes = parseInt(quotesOption.value);

                // Create an options object for Terser
                var options = {
                    compress: compress,
                    mangle: mangle,
                    format: {
                        beautify: beautify,
                        quote_style: quotes
                    }
                };

                // Use an async function to minify the code using Terser and catch any errors
                async function asyncMinify() {
                    try {
                        // Minify the code and get the result object
                        var result = await minify(inputText, options);

                        // Check if there is an error in the result
                        if (result.error) {
                            // Throw the error
                            throw result.error;
                        }

                        // Set the text content of the output area to the minified code
                        outputArea.value = result.code;

                        // Update the size labels
                        updateSizeLabels();
                    } catch (error) {
                        // Display an alert with the error message
                        alert(error.message);
                    }
                }

                // Call the async function
                asyncMinify();
            }

            // Add an event listener to the minify button
            minifyButton.addEventListener("click", minifyCode);

            // Call the update function when the page loads
            updateSizeLabels();
        </script>
        <script src="./scripts/minify.js"></script>


    </body>

</html>
